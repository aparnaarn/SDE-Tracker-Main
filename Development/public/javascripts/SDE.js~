var app = angular.module('app', ['ngRoute', 'duScroll']);

app.config(function ($routeProvider) {
	$routeProvider
		//go to main page
		.when('/main', {
			templateUrl: 'main.html',
			controller: 'mainController'
		})
        //go to pendingWeeks page
		.when('/pendingWeeks', {
			templateUrl: 'pendingWeeks.html',
			controller: 'pendingController'
		});
});

app.controller('mainController', function ($scope, $http) {

	$scope.clusters = ["WC","EC","PP","IT","Admin","Other"];
   	
	$http.get("/api/getAccounts").success(function (response) {

		$scope.allaccounts = [];
		
		for( x in response){
			console.log(response[x]);
			$scope.allaccounts.push(response[x]);		
		}

		console.log($scope.allaccounts);
	});		
	
	$scope.getAccounts = function () {
		$scope.accounts = [];

		for( x in $scope.allaccounts){
			if($scope.coast == $scope.allaccounts[x].cluster)
				$scope.accounts.push($scope.allaccounts[x]);	
		}
	
		console.log($scope.accounts);

	};
	
	var today = new Date();
	var months = new Array();
	months[0] = "January";
	months[1] = "February";
	months[2] = "March";
	months[3] = "April";
	months[4] = "May";
	months[5] = "June";
	months[6] = "July";
	months[7] = "August";
	months[8] = "September";
	months[9] = "October";
	months[10] = "November";
	months[11] = "December";
	
	var year = today.getFullYear();
	var month = today.getMonth();
	var monthName = months[month];
	var previousMonth = getPreviousMonth();
	var previousMonthName = months[previousMonth];
	var previousMonthYear = getPreviousMonthYear();
		
	function getPreviousMonth(){
		if(month ==0 )
			return 11;
		else
			return month - 1;
	}
	
	function getPreviousMonthYear(){
		if(month == 0)
			return year-1;
		else 
			return year;
	}
	
	function getFridays(year,month){ 
		var fridays=new Array();
		var i=0;
		var tdays=new Date(year, month, 0).getDate();
		for(date=0;date<=tdays;date++)     {
			sdate=(date<10)?"0"+date:date; 
			dd=(months[month]+" "+sdate+", "+year);  
			var day=new Date(year,month,date); 
			if(day.getDay() == 5 )  
			{  
				fridays[i++]=dd;
			}    
		}   
		return fridays; 
    }
	
	function setDay(dayOfWeek) {
		date = new Date();
		date.setDate(date.getDate() + (dayOfWeek - 7 - date.getDay()) % 7);
		return (months[date.getMonth()]+" "+date.getDate()+", "+date.getFullYear());
	}
	
	$scope.dates = [monthName, previousMonthName];
	$scope.fridays = getFridays (year, month);
	$scope.previousFridays = getFridays (previousMonthYear, previousMonth);
	$scope.month = monthName;
	$scope.previousMonth = previousMonthName;
	
	$scope.selectedWeek = setDay(5);
	
	$scope.setSelectedWeek = function(day) {
		$scope.selectedWeek = day;
	}
          
    $scope.clientSatisfaction = {
        satisfaction: {id: '1', name: 'Extremely Satisfied'},
        availableOptions: [
            {id: '1', name: 'Extremely Satisfied'},
            {id: '2', name: 'Satisfied'},
            {id: '3', name: 'Neither Satisfied not dissatisfied'},
            {id: '4', name: 'Disatisfied'},
            {id: '5', name: 'Extremely Disatisfied'},
            {id: '6', name: 'Not Available'}
        ]
    };
	
    
    $scope.serviceType = {
        service: {id: '1', name: 'Milestone-High Visibilty'},
        availableOptions: [
            {id: '1', name: 'Milestone-High Visibilty'},
            {id: '2', name: 'Recurring-High Visibility'},
            {id: '3', name: 'Milestone'},
            {id: '4', name: 'Recurring'}
        ]
    };
   
    $scope.entry = {
        weekOf: '',
	cluster: '',
	account: '',
        projectName: '',
        serviceType: '',
        deliverableName: '',
        noOfDeliverables: '',
        description: '',
	totalIssues: '',
	totalIssueComments: '',
	criticalIssues: '',
	criticalIssueComments: '',
	presentationErrors: '',	
	presentationErrorComments: '',
	communicationLapse: '',
	lapseComments: '',
	deadlinesMissed: '',
	deadlineMissComments: '',
	docper: '',
	docComments: '',
	findingsper: '',
	findings: '',
	noOfInsights: '',
	businessInsight: '',
	businessMetric: '',
	comments: '',
	dollarValue: '',
        clientSatisfaction: '',
	negativeReviews: '',
	negativeFeedback: '',
	generalComments: ''
    };
    
    $scope.submit = function () {
	console.log($scope.account);
        $scope.entry.weekOf = $scope.selectedWeek;
	$scope.entry.cluster = $scope.coast;	
	$scope.entry.account = $scope.account.accountName;
        $scope.entry.projectName = $scope.projectName;
        $scope.entry.serviceType = $scope.serviceType.service.name;
        $scope.entry.clientSatisfaction = $scope.clientSatisfaction.satisfaction.name;
	console.log($scope.entry.deliverableName);
        $http.post("/api/SDE", $scope.entry).success(function (response) {
			console.log(response);
		});
    };
});

app.controller('pendingController', function ($scope) {
	
});
